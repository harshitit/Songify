<!DOCTYPE html>
<html>
<head>
	<title>Songify</title>
	<script src="artyom.min.js"></script>
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="main.css">
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">
</head>
<body>
	<div class="welcome-screen">
        <h1> Welcome to Songify </h1>
        <h3> Enter Your Name</h3>
        <div id="input-fields">
        	<input type="text" placeholder="Name" id="name-input">
    	    <button> Roll In </button>
    	    <p id="error-message">more than 3 words</p>
        </div>
    </div>
    <div class="music-player">
		<header>
			<div class="title">
				<h1>Songify</h1>
				<p class="user-name"></p>
				<p class="song-search">Search: <input type="search" placeholder="song name" id="search-box"></p>
			</div>
		</header>
		<div class="current-song-details">
	    	<img class="current-song-image">
	    	<div>
	       		<p class="current-song-name"></p>
	       		<p class="current-song-album"></p>
	   		</div>
		</div>
		<div class="song-details">
			<table id="songs">
				<thead>
					<tr>
						<td>Title</td>
						<td>Artist</td>
						<td>Album</td>
						<td>Duration</td>
					</tr>
				</thead>
				<tbody>
					<tr id='song1'>
						<td class="song-name"></td>
						<td class="song-artist"></td>
						<td class="song-album"></td>
						<td class="song-duration"></td>
					</tr>
					<tr id='song2'>
						<td class="song-name"></td>
						<td class="song-artist"></td>
						<td class="song-album"></td>
						<td class="song-duration"></td>
					</tr>
					<tr id='song3'>
						<td class="song-name"></td>
						<td class="song-artist"></td>
						<td class="song-album"></td>
						<td class="song-duration"></td>
					</tr>
					<tr id='song4'>
						<td class="song-name"></td>
						<td class="song-artist"></td>
						<td class="song-album"></td>
						<td class="song-duration"></td>
					</tr>
				</tbody>
			</table>
		</div>
		<footer>
			<div class="play-bar">
				<p class="current-time"></p>
				<div class="play-box">
					<i class="fa fa-play play"></i>
				</div>
				<p class="duration"></p>
			</div>
			<audio></audio>
		</footer>
	</div>
	<script src="jquery-2.2.0.js"></script>
	<script type="text/javascript" src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>
	<script>
		function voice(){
			artyom.addCommands([
	{
		description:"say hello",
		indexes:["play"],
		action:function(i){
			var song = document.querySelector('audio');
			if (i==0) {
					song.play();
					$('.play').removeClass('fa-play').addClass('fa-pause');
			}
		}
	},
	{
		indexes:["pause","stop"],
		action:function(){
			var song = document.querySelector('audio');
			song.pause();
			$('.play').removeClass('fa-pause').addClass('fa-play');
		}
	}
	])};
	function startArtyom(){
         artyom.initialize({
            lang:"en-GB",// A lot of languages are supported. Read the docs !
            continuous:true,// recognize 1 command and stop listening !
            listen:true, // Start recognizing
            debug:true, // Show everything in the console
            });
     }
		$(".music-player").hide();
		$(".duration").hide();
		$('button').on('click', function() {
        var name = $('#name-input').val();
        if (name.length > 3) {
            var message = "Welcome, " + name;
            $('.user-name').text(message);
            $('.welcome-screen').hide();
            $('.music-player').toggle();
            startArtyom();

        } else {
            alert("Enter your name more than 3 words");
        }
    });
		var songs = [
		{
	        'name': 'Meri Bheegi Bheegi Si',
	        'artist': 'Kishore Kumar',
	        'album': 'Kishore Kumar In Mood',
	        'duration': '4:04',
	        'fileName': 'song.mp3',
	        'image': 'image.jpg'
	    },
	    {
	        'name': 'Ikk Kudi',
	        'artist': 'Shahid Mallya',
	        'album': 'Udta Punjab',
	        'duration': '4:03',
	        'fileName': 'song1.mp3',
	        'image': 'image1.jpg'
	    },
	    {
	        'name': 'Te Amo (Reprise)',
	        'artist': 'Mohit Chauhan',
	        'album': 'Dum Maaro Dum',
	        'duration': '4:56',
	        'fileName': 'song2.mp3',
	        'image': 'image2.jpg'
	    },
	    {
	        'name': 'Photograph',
	        'artist': 'Ed Sheeran',
	        'album': 'x',
	        'duration': '4:18',
	        'fileName': 'song3.mp3',
	        'image': 'image3.jpg'
	    }
	    ]
	    window.onload = function (){
		changeCurrentSongDetails(songs[0]);

	 	for(var i = 0; i < songs.length; i++) {
	        var obj = songs[i];
	        var name = '#song' + (i+1);
	        var song = $(name);
	        song.find('.song-name').text(obj.name);
	        song.find('.song-artist').text(obj.artist);
	        song.find('.song-album').text(obj.album);
	        song.find('.song-duration').text(obj.duration);
	        addSongNameClickEvent(obj, i + 1);
    	}
		}
		$(document).ready(function(){
			$("#search-box").keyup(function(){
				searchSong($(this).val());
			});
			function searchSong(value){
				$("#songs tbody tr").each(function(){
					var found="false";
					$(this).each(function(){
						if ($(this).text().toLowerCase().indexOf(value.toLowerCase()) >= 0) 
						{
							found="true";
						}
					});
					if (found == "true") 
					{
						$(this).show();
					}
					else
					{
						$(this).hide();
					}
				});
			}
		});
		function fancyTimeFormat(time)
		{   
    		var hrs = ~~(time / 3600);
    		var mins = ~~((time % 3600) / 60);
    		var secs = time % 60;
			var ret = "";
    		if (hrs > 0) {
        	ret += "" + hrs + ":" + (mins < 10 ? "0" : "");
    		}
    		ret += "" + mins + ":" + (secs < 10 ? "0" : "");
    		ret += "" + secs;
    		return ret;
		}
		function toggleSong() {
		var song = document.querySelector('audio'); 
		if(song.paused) {
			song.play();
			$('.play').removeClass('fa-play').addClass('fa-pause');	
		} else {
			song.pause();
			$('.play').removeClass('fa-pause').addClass('fa-play');
		}
		}
		$('body').on('keypress',function(event){
			if (event.keyCode==32) {
				toggleSong();
		}
		});
		$('.play').on('click',function(){
				toggleSong();
		});
		setInterval(function(){
			var song=$('audio');
			$('.current-time').text(fancyTimeFormat(Math.floor(song[0].currentTime)));
		},100);
		setInterval(function(){
			var song=$('audio');
			$('.duration').text(fancyTimeFormat(Math.floor(song[0].duration)));
		},100);
		function addSongNameClickEvent(songObj, id) {
			var songName = songObj.name;
			var fileName = songObj.fileName;
			var id = '#song' + id;
			$(id).on('click', function(event){
				var song = document.querySelector('audio');
				var currentSong = song.src;
				$(".duration").show();
				if (currentSong.search(fileName) != -1) {
					toggleSong();
				} else {
					changeCurrentSongDetails(songObj);
					song.src = fileName;
					song.play();
					voice();
					$('.play').removeClass('fa-play').addClass('fa-pause');	
				}
			});
		}
	function changeCurrentSongDetails(songObj) {
		var songPath = songObj.image;
	    $('.current-song-image').attr('src', songPath)
	    $('.current-song-name').text(songObj.name)
	    $('.current-song-album').text(songObj.album)
	}
	</script>
</body>
</html>